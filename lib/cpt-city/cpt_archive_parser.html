<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>CPT City Archive Parser</title>
  <style>
    * { margin: 0; padding: 0; box-sizing: border-box; }
    body {
      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      min-height: 100vh;
      padding: 20px;
    }
    .container {
      max-width: 1600px;
      margin: 0 auto;
      background: white;
      border-radius: 16px;
      box-shadow: 0 20px 60px rgba(0,0,0,0.3);
      padding: 40px;
    }
    h1 { color: #333; margin-bottom: 10px; font-size: 28px; }
    .subtitle { color: #666; margin-bottom: 20px; font-size: 14px; }
    .info-links {
      background: #e3f2fd;
      border-left: 4px solid #2196F3;
      padding: 12px 16px;
      border-radius: 8px;
      margin-bottom: 20px;
      font-size: 13px;
      display: flex;
      gap: 20px;
      flex-wrap: wrap;
      align-items: center;
    }
    .info-links a { color: #1976D2; text-decoration: none; font-weight: 600; }
    .info-links a:hover { text-decoration: underline; }
    .info-links .separator { color: #ccc; }
    .upload-area {
      border: 3px dashed #667eea;
      border-radius: 12px;
      padding: 30px;
      text-align: center;
      background: #f8f9ff;
      margin-bottom: 20px;
      cursor: pointer;
      transition: all 0.3s;
      user-select: none;
    }
    .upload-area:hover, .upload-area:active { background: #eef0ff; border-color: #764ba2; }
    .upload-area.dragover { background: #e0e7ff; border-color: #4f46e5; }
    .upload-area * { pointer-events: none; }
    input[type="file"] { display: none; }
    .upload-icon { font-size: 36px; margin-bottom: 8px; }
    .stats {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
      gap: 12px;
      margin-bottom: 20px;
    }
    .stat-card {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
      padding: 15px;
      border-radius: 8px;
      text-align: center;
    }
    .stat-value { font-size: 24px; font-weight: bold; margin-bottom: 4px; }
    .stat-label { font-size: 11px; opacity: 0.9; text-transform: uppercase; letter-spacing: 0.5px; }
    .controls {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
      gap: 12px;
      margin-bottom: 15px;
    }
    .control-group { display: flex; flex-direction: column; }
    label { font-weight: 600; color: #333; margin-bottom: 6px; font-size: 12px; }
    select, input[type="text"], input[type="number"] {
      padding: 8px;
      border: 2px solid #e0e0e0;
      border-radius: 6px;
      font-size: 13px;
      transition: border-color 0.3s;
    }
    select:focus, input[type="text"]:focus, input[type="number"]:focus {
      outline: none;
      border-color: #667eea;
    }
    .button-group { display: flex; gap: 8px; margin-bottom: 15px; flex-wrap: wrap; }
    button {
      padding: 10px 20px;
      border: none;
      border-radius: 6px;
      font-size: 13px;
      font-weight: 600;
      cursor: pointer;
      transition: all 0.3s;
    }
    .btn-primary {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      color: white;
    }
    .btn-primary:hover:not(:disabled) {
      transform: translateY(-2px);
      box-shadow: 0 8px 16px rgba(102, 126, 234, 0.3);
    }
    .btn-secondary { background: #4CAF50; color: white; }
    .btn-secondary:hover:not(:disabled) { background: #45a049; }
    button:disabled { opacity: 0.5; cursor: not-allowed; }
    .table-container {
      background: white;
      border-radius: 8px;
      overflow: hidden;
      border: 1px solid #e0e0e0;
    }
    table { width: 100%; border-collapse: collapse; font-size: 13px; }
    thead { background: #f5f5f5; position: sticky; top: 0; z-index: 10; }
    th {
      padding: 10px 8px;
      text-align: left;
      font-weight: 600;
      color: #333;
      border-bottom: 2px solid #e0e0e0;
      cursor: pointer;
      user-select: none;
    }
    th:hover { background: #eeeeee; }
    td { padding: 8px; border-bottom: 1px solid #f0f0f0; }
    tr:hover { background: #f9f9f9; }
    .cpt-image {
      width: 60px;
      height: 20px;
      object-fit: cover;
      border-radius: 3px;
      cursor: pointer;
      border: 1px solid #ddd;
    }
    .cpt-image:hover {
      transform: scale(1.5);
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      z-index: 100;
      position: relative;
    }
    .license-badge {
      display: inline-block;
      padding: 3px 8px;
      border-radius: 3px;
      font-size: 10px;
      font-weight: 600;
      text-transform: uppercase;
      white-space: nowrap;
    }
    .license-cc, .license-gpl, .license-apache, .license-mit, .license-bsd {
      background: #4CAF50;
      color: white;
    }
    .license-other { background: #ff9800; color: white; }
    .license-unknown, .license-none { background: #999; color: white; }
    .distribute-yes { color: #4CAF50; font-weight: 600; }
    .distribute-no { color: #f44336; font-weight: 600; }
    .pagination {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 15px;
      background: #f5f5f5;
      border-top: 1px solid #e0e0e0;
    }
    .pagination-info { font-size: 13px; color: #666; }
    .pagination-controls { display: flex; gap: 8px; align-items: center; }
    .pagination-controls button { padding: 6px 12px; font-size: 12px; }
    .page-input { width: 60px; text-align: center; }
    .progress { margin: 15px 0; display: none; }
    .progress-bar {
      width: 100%;
      height: 24px;
      background: #e0e0e0;
      border-radius: 12px;
      overflow: hidden;
    }
    .progress-fill {
      height: 100%;
      background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
      transition: width 0.3s;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-weight: 600;
      font-size: 11px;
    }
    .table-filters {
      background: #f9f9f9;
      padding: 10px;
      border-bottom: 1px solid #e0e0e0;
    }
    .table-filters input {
      width: 100%;
      padding: 6px 8px;
      border: 1px solid #ddd;
      border-radius: 4px;
      font-size: 12px;
    }
    a { color: #667eea; text-decoration: none; }
    a:hover { text-decoration: underline; }
    .results { margin-top: 20px; }
  </style>
</head>
<body>
  <div class="container">
    <h1>üé® CPT City Archive Parser</h1>
    <p class="subtitle">Parse and filter CPT color palettes from the CPT City archive</p>
    
    <div class="info-links">
      <span>üè† <a href="http://seaviewsensing.com/pub/cpt-city/" target="_blank">CPT City Home</a></span>
      <span class="separator">|</span>
      <span>üëÅÔ∏è <a href="http://seaviewsensing.com/pub/cpt-city/views/" target="_blank">Views Directory</a></span>
      <span class="separator">|</span>
      <span>üì¶ <a href="http://seaviewsensing.com/pub/cpt-city/pkg/" target="_blank">Download Archive</a></span>
      <span class="separator">|</span>
      <span>¬©Ô∏è <a href="http://seaviewsensing.com/pub/cpt-city/notes/copyright.html" target="_blank">Copyright Info</a></span>
    </div>

    <div class="upload-area" id="uploadArea">
      <div class="upload-icon">üìÅ</div>
      <h3>Drop ZIP file here or click to browse</h3>
      <p style="color: #666; margin-top: 8px; font-size: 13px;">cpt-city-cpt-2.27.zip</p>
      <input type="file" id="fileInput" accept=".zip">
    </div>
    
    <div class="progress" id="progress">
      <div class="progress-bar">
        <div class="progress-fill" id="progressFill">0%</div>
      </div>
    </div>
    
    <div class="stats" id="stats" style="display: none;">
      <div class="stat-card">
        <div class="stat-value" id="totalCpts">0</div>
        <div class="stat-label">Total CPTs</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="totalDirs">0</div>
        <div class="stat-label">Directories</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="filteredCpts">0</div>
        <div class="stat-label">Filtered</div>
      </div>
      <div class="stat-card">
        <div class="stat-value" id="openLicenseCpts">0</div>
        <div class="stat-label">Open License</div>
      </div>
    </div>
    
    <div class="controls" id="controls" style="display: none;">
      <div class="control-group">
        <label>View Filter</label>
        <select id="viewFilter">
          <option value="all">All CPTs</option>
        </select>
      </div>
      <div class="control-group">
        <label>License Filter</label>
        <select id="licenseFilter">
          <option value="all">All Licenses</option>
          <option value="open">Open Licenses (CC/GPL/MIT/Apache/BSD)</option>
          <option value="distribute-yes">Distribute: Yes</option>
          <option value="open-distribute">Open + Distribute Yes</option>
        </select>
      </div>
      <div class="control-group">
        <label>Search Name</label>
        <input type="text" id="nameSearch" placeholder="Search CPT names...">
      </div>
      <div class="control-group">
        <label>Directory Filter</label>
        <select id="dirFilter">
          <option value="all">All Directories</option>
        </select>
      </div>
      <div class="control-group">
        <label>Items Per Page</label>
        <select id="itemsPerPage">
          <option value="25">25</option>
          <option value="50">50</option>
          <option value="100">100</option>
          <option value="200" selected>200</option>
        </select>
      </div>
    </div>
    
    <div class="button-group" id="actions" style="display: none;">
      <button class="btn-secondary" onclick="downloadJSON()">Download Full JSON</button>
      <button class="btn-secondary" onclick="downloadFiltered()">Download Filtered JSON</button>
      <button class="btn-primary" onclick="copyToClipboard()">Copy Filtered to Clipboard</button>
    </div>
    
    <div class="results" id="results" style="display: none;">
      <div class="table-container">
        <table>
          <thead>
            <tr id="tableHeader"></tr>
            <tr id="tableFilters" class="table-filters"></tr>
          </thead>
          <tbody id="tableBody"></tbody>
        </table>
        <div class="pagination">
          <div class="pagination-info" id="paginationInfo"></div>
          <div class="pagination-controls">
            <button class="btn-primary" onclick="changePage(-1)">‚Üê Prev</button>
            <input type="number" class="page-input" id="pageInput" min="1" value="1">
            <button class="btn-primary" onclick="changePage(1)">Next ‚Üí</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.10.1/jszip.min.js"></script>
  <script>
    // ============================================================================
    // STATE MANAGEMENT
    // ============================================================================
    let parsedData = null;
    let filteredData = [];
    let currentPage = 1;
    let itemsPerPage = 200;
    let sortColumn = null;
    let sortDirection = 'asc';
    let columnFilters = {};
    let viewsData = {};
    let currentView = 'all';
    
    const columns = [
      { id: 'image', label: 'Preview', sortable: false, filterable: false },
      { id: 'name', label: 'Name', sortable: true, filterable: true },
      { id: 'directory', label: 'Directory', sortable: true, filterable: true },
      { id: 'license', label: 'License', sortable: true, filterable: true },
      { id: 'distribute', label: 'Distribute', sortable: true, filterable: true },
      { id: 'author', label: 'Author', sortable: true, filterable: true },
      { id: 'copyingFile', label: 'COPYING.xml', sortable: false, filterable: false }
    ];
    
    // ============================================================================
    // FILE UPLOAD HANDLING
    // ============================================================================
    const uploadArea = document.getElementById('uploadArea');
    const fileInput = document.getElementById('fileInput');
    
    uploadArea.addEventListener('mousedown', function(e) {
      e.preventDefault();
      e.stopPropagation();
      fileInput.click();
    });
    
    uploadArea.addEventListener('touchstart', function(e) {
      e.preventDefault();
      e.stopPropagation();
      fileInput.click();
    }, { passive: false });
    
    uploadArea.addEventListener('dragover', function(e) {
      e.preventDefault();
      uploadArea.classList.add('dragover');
    });
    
    uploadArea.addEventListener('dragleave', function() {
      uploadArea.classList.remove('dragover');
    });
    
    uploadArea.addEventListener('drop', function(e) {
      e.preventDefault();
      uploadArea.classList.remove('dragover');
      const file = e.dataTransfer.files[0];
      if (file) handleFile(file);
    });
    
    fileInput.addEventListener('change', function(e) {
      const file = e.target.files[0];
      if (file) handleFile(file);
    });
    
    // ============================================================================
    // ZIP PARSING - MAIN ENTRY POINT
    // ============================================================================
    async function handleFile(file) {
      document.getElementById('progress').style.display = 'block';
      updateProgress(0, 'Loading ZIP...');
      
      try {
        const zip = await JSZip.loadAsync(file);
        updateProgress(20, 'Parsing structure...');
        
        parsedData = await parseZipStructure(zip);
        
        updateProgress(100, 'Complete!');
        
        document.getElementById('stats').style.display = 'grid';
        document.getElementById('controls').style.display = 'grid';
        document.getElementById('actions').style.display = 'flex';
        
        populateDirectoryFilter();
        initializeTable();
        addEmbeddedViews();
        applyFilters();
        
        setTimeout(function() {
          document.getElementById('progress').style.display = 'none';
        }, 1000);
        
      } catch (error) {
        console.error('Error parsing ZIP:', error);
        alert('Error parsing ZIP file: ' + error.message);
      }
    }
    
    function updateProgress(percent, text) {
      const fill = document.getElementById('progressFill');
      fill.style.width = percent + '%';
      fill.textContent = text || percent + '%';
    }
    
    // ============================================================================
    // PARSE CPT PACKAGE ZIP
    // ============================================================================
    async function parseZipStructure(zip) {
      const data = {
        directories: {},
        cpts: [],
        stats: {
          totalCpts: 0,
          totalDirectories: 0,
          openLicenseCpts: 0
        }
      };
      
      const files = Object.keys(zip.files);
      const totalFiles = files.length;
      let processedFiles = 0;
      
      // First pass: collect all COPYING.xml files
      const copyingFiles = {};
      for (const filename of files) {
        if (filename.endsWith('COPYING.xml')) {
          const content = await zip.files[filename].async('string');
          const dirPath = filename.replace('/COPYING.xml', '');
          copyingFiles[dirPath] = {
            ...parseCopyingXML(content),
            path: filename
          };
        }
      }
      
      // Second pass: collect CPT files and associate with nearest COPYING.xml
      for (const filename of files) {
        processedFiles++;
        if (processedFiles % 100 === 0) {
          updateProgress(20 + (processedFiles / totalFiles) * 60, 'Processing ' + processedFiles + '/' + totalFiles);
          await new Promise(function(resolve) { setTimeout(resolve, 0); });
        }
        
        if (filename.endsWith('.cpt') && !zip.files[filename].dir) {
          const content = await zip.files[filename].async('string');
          const parts = filename.split('/');
          const name = parts[parts.length - 1].replace('.cpt', '');
          const dirPath = parts.slice(0, -1).join('/');
          
          // Associate nearest COPYING.xml by traversing up directory tree
          let license = null;
          let copyingPath = null;
          let currentPath = dirPath;
          while (currentPath && !license) {
            if (copyingFiles[currentPath]) {
              license = copyingFiles[currentPath];
              copyingPath = copyingFiles[currentPath].path;
              break;
            }
            const pathParts = currentPath.split('/');
            pathParts.pop();
            currentPath = pathParts.join('/');
          }
          
          if (!license) {
            license = {
              distribute: 'unknown',
              licenseType: 'unknown',
              author: 'unknown',
              source: 'unknown',
              path: null
            };
          }

          const isOpenLicense = isOpenSourceLicense(license.licenseType);
          if (isOpenLicense) {
            data.stats.openLicenseCpts++;
          }
          
          const cptObj = {
            name: name,
            path: filename,
            directory: dirPath,
            content: content,
            license: license.licenseType,
            distribute: license.distribute,
            author: license.author,
            source: license.source,
            copyingFile: copyingPath,
            isOpenLicense: isOpenLicense
          };
          
          data.cpts.push(cptObj);
          data.stats.totalCpts++;
          
          if (!data.directories[dirPath]) {
            data.directories[dirPath] = [];
            data.stats.totalDirectories++;
          }
          data.directories[dirPath].push(cptObj);
        }
      }
      
      return data;
    }
    
    // ============================================================================
    // EXTRACT LICENSE ATTRIBUTES FROM COPYING.XML
    // ============================================================================
    function parseCopyingXML(xmlString) {
      const parser = new DOMParser();
      const xml = parser.parseFromString(xmlString, 'text/xml');
      
      const parserError = xml.querySelector('parsererror');
      if (parserError) {
        return null;
      }
      
      const license = {};
      
      const qgis = xml.querySelector('distribute qgis');
      if (qgis) {
        license.distribute = qgis.getAttribute('distribute') || 'unknown';
        license.licenseType = qgis.getAttribute('license') || 'unknown';
      }
      
      const authorNode = xml.querySelector('authors author');
      if (authorNode) {
        license.author = authorNode.textContent.trim();
      }
      
      const srcNode = xml.querySelector('src url');
      if (srcNode) {
        license.source = srcNode.textContent.trim();
      }
      
      return license;
    }

    function isOpenSourceLicense(licenseText) {
      if (!licenseText || licenseText === 'unknown' || licenseText === 'none') {
        return false;
      }
      
      const lower = licenseText.toLowerCase();
      return lower.includes('cc') || 
             lower.includes('creative commons') || 
             lower.includes('creative-commons') ||
             lower.includes('gpl') ||
             lower.includes('apache') ||
             lower.includes('mit') ||
             lower.includes('bsd') ||
             lower.includes('public domain');
    }

    function formatLicense(license) {
      if (!license || license === 'unknown' || license === 'none') {
        return license;
      }
      
      if (license.length <= 30) {
        return license;
      }

      const lower = license.toLowerCase();
      if (lower.includes('creative commons') || lower.includes('cc-')) {
        const match = license.match(/cc[- ](by|sa|nc|nd|zero|0)([- ](by|sa|nc|nd|zero|0))*/i);
        return match ? match[0].toUpperCase() : 'CC';
      }
      if (lower.includes('gpl')) return 'GPL';
      if (lower.includes('apache')) return 'Apache';
      if (lower.includes('mit')) return 'MIT';
      if (lower.includes('bsd')) return 'BSD';
      if (lower.includes('public domain')) return 'Public Domain';
      
      return license.substring(0, 27) + '...';
    }

    function getLicenseClass(license) {
      if (!license || license === 'unknown') return 'license-unknown';
      if (license === 'none') return 'license-none';
      
      const lower = license.toLowerCase();
      if (lower.includes('cc') || lower.includes('creative commons')) return 'license-cc';
      if (lower.includes('gpl')) return 'license-gpl';
      if (lower.includes('apache')) return 'license-apache';
      if (lower.includes('mit')) return 'license-mit';
      if (lower.includes('bsd')) return 'license-bsd';
      
      return 'license-other';
    }

    // ============================================================================
    // PARSE VIEW XML FILES
    // ============================================================================
    function parseViewXML(xmlString) {
      const parser = new DOMParser();
      const xml = parser.parseFromString(xmlString, 'text/xml');
      
      const gradients = xml.querySelectorAll('gradient');
      const result = [];
      
      for (let i = 0; i < gradients.length; i++) {
        const g = gradients[i];
        const file = g.getAttribute('file');
        const dir = g.getAttribute('dir');
        if (file && dir) {
          result.push({ file: file, dir: dir });
        }
      }
      
      return result;
    }

    function addEmbeddedViews() {
      const viewFilter = document.getElementById('viewFilter');
      
      const topobathXML = `<selection cadence="low">
        <name short="topobath">Topography/bathymetry</name>
        <gradients>
        <gradient file="ibcao" dir="ibcao"/>
        <gradient file="NZ_blue" dir="em"/>
        <gradient file="wiki-2.0" dir="wkp/template"/>
        <gradient file="wiki-scotland" dir="wkp/country"/>
        <gradient file="wiki-france" dir="wkp/country"/>
        <gradient file="GMT_globe" dir="gmt"/>
        <gradient file="GMT_relief" dir="gmt"/>
        <gradient file="GMT_sealand" dir="gmt"/>
        <gradient file="GMT_topo" dir="gmt"/>
        <gradient file="Caribbean" dir="vh"/>
        <gradient file="etopo2" dir="grass"/>
        <gradient file="srtm" dir="grass"/>
        <gradient file="terrain" dir="grass"/>
        <gradient file="ETOPO1" dir="ngdc"/>
        <gradient file="ETOPO1-Reed" dir="ngdc"/>
        <gradient file="wiki-plumbago" dir="wkp/plumbago"/>
        <gradient file="topo_15lev" dir="ncl"/>
        <gradient file="meyers" dir="wkp/encyclopedia"/>
        <gradient file="nordisk-familjebok" dir="wkp/encyclopedia"/>
        <gradient file="mby" dir="mby"/>
        <gradient file="afrikakarte" dir="wkp/lilleskut"/>
        <gradient file="colombia" dir="wkp/shadowxfox"/>
        <gradient file="arctic" dir="arendal"/>
        </gradients>
        </selection>`;
      const topoXML = `<selection cadence="low">
          <name short="topo">Topography</name>
          <gradients>
            <gradient file="DEM_poster" dir="td"/>
            <gradient file="DEM_print" dir="td"/>
            <gradient file="DEM_screen" dir="td"/>
            <gradient file="c3t1" dir="jjg/dem"/>
            <gradient file="c3t3" dir="jjg/dem"/>
            <gradient file="garish14" dir="jjg/dem"/>
            <gradient file="natural" dir="fme/feet"/>
            <gradient file="neutral" dir="fme/feet"/>
            <gradient file="textbook" dir="fme/feet"/>
            <gradient file="tv-a" dir="jm/tv"/>
            <gradient file="o2-a" dir="jm/o2"/>
            <gradient file="db-a" dir="jm/db"/>
            <gradient file="ao-a" dir="jm/ao"/>
            <gradient file="wt-a" dir="jm/wt"/>
            <gradient file="ws-a" dir="jm/ws"/>
            <gradient file="cd-a" dir="jm/cd"/>
            <gradient file="sd-a" dir="jm/sd"/>
            <gradient file="elevation" dir="grass"/>
            <gradient file="njdem100" dir="njgs"/>
            <gradient file="palm_springs_4" dir="esri/hypsometry/na"/>
            <gradient file="pnw_1113" dir="esri/hypsometry/na"/>
            <gradient file="utah_1" dir="esri/hypsometry/na"/>
            <gradient file="europe_3" dir="esri/hypsometry/eu"/>
            <gradient file="iceland" dir="esri/hypsometry/eu"/>
            <gradient file="spain" dir="esri/hypsometry/eu"/>
            <gradient file="os250k-feet" dir="os"/>
            <gradient file="tpushuf" dir="tp"/>
            <gradient file="wiki-schwarzwald-cont" dir="wkp/schwarzwald"/>
            <gradient file="wiki-schwarzwald-d050" dir="wkp/schwarzwald"/>
            <gradient file="wiki-knutux" dir="wkp/knutux"/>
            <gradient file="nrwc" dir="wkp/tubs"/>
            <gradient file="pakistan" dir="wkp/jarke"/>
            <gradient file="usgs-gswa2" dir="usgs"/>
            <gradient file="zambezi-focus" dir="arendal"/>
            <gradient file="zambezi-proximity" dir="arendal"/>
          </gradients>
        </selection>`;

      const tempXML = `
        <selection cadence="low">
          <name short="temp">Temperature</name>
          <synopsis>Palettes for temperature</synopsis>
          <description>Palettes for temperature.</description>
          <gradients>
            <gradient dir="oc" file="sst"/>
            <gradient dir="jjg/misc" file="temperature"/>
            <gradient dir="grass" file="celsius"/>
            <gradient dir="ukmo/wow" file="temp-c"/>
            <gradient dir="ncl" file="temp_19lev"/>
            <gradient dir="arendal" file="temperature"/>
          </gradients>
        </selection>`
      const totpCptXML = `
        <selection cadence="high">
          <name short="totp-cpt">Top of the (cpt) palettes</name>
          <synopsis>The 75 most popular cpt gradients 
            on 31/08/2023</synopsis>
          <description>
            The 75 most popular cpt files with the number downloaded 
            shown in parentheses. The arrows indicate the change in rank in the last
            month. This list is compiled from the files downloaded in the last year 
            (a total of 21,343 files) and is updated irregularly, most recently on 
            31/08/2023.
          </description>
          <gradients>

            <gradient 
              file="temperature" 
              dir="arendal"  
              rank="1"
              direction="up" 
              downloads="559"/>

            <gradient 
              file="colombia" 
              dir="wkp/shadowxfox"  
              rank="2"
              direction="unchanged"
              downloads="415"/>

            <gradient 
              file="DEM_print" 
              dir="td"  
              rank="3"
              direction="unchanged"
              downloads="271"/>

            <gradient 
              file="wiki-2.0" 
              dir="wkp/template"  
              rank="4"
              direction="up" 
              downloads="250"/>

            <gradient 
              file="usgs" 
              dir="usgs"  
              rank="5"
              direction="up" 
              downloads="239"/>

            <gradient 
              file="BlueWhiteOrangeRed" 
              dir="ncl"  
              rank="5"
              direction="down"
              downloads="239"/>

            <gradient 
              file="ETOPO1" 
              dir="ngdc"  
              rank="7"
              direction="up" 
              downloads="231"/>

            <gradient 
              file="DEM_screen" 
              dir="td"  
              rank="8"
              direction="down"
              downloads="230"/>

            <gradient 
              file="arctic" 
              dir="arendal"  
              rank="9"
              direction="down"
              downloads="224"/>

            <gradient 
              file="DEM_poster" 
              dir="td"  
              rank="10"
              direction="unchanged"
              downloads="216"/>

            <gradient 
              file="seismic" 
              dir="gery"  
              rank="11"
              direction="unchanged"
              downloads="198"/>

            <gradient 
              file="mby" 
              dir="mby"  
              rank="12"
              direction="unchanged"
              downloads="191"/>

            <gradient 
              file="GMT_globe" 
              dir="gmt"  
              rank="13"
              direction="unchanged"
              downloads="183"/>

            <gradient 
              file="wiki-schwarzwald-cont" 
              dir="wkp/schwarzwald"  
              rank="14"
              direction="unchanged"
              downloads="182"/>

            <gradient 
              file="usgs-feet" 
              dir="usgs"  
              rank="15"
              direction="unchanged"
              downloads="176"/>

            <gradient 
              file="GTS2012_epochs" 
              dir="heine"  
              rank="16"
              direction="unchanged"
              downloads="175"/>

            <gradient 
              file="elevation" 
              dir="grass"  
              rank="17"
              direction="unchanged"
              downloads="165"/>

            <gradient 
              file="GMT_seis" 
              dir="gmt"  
              rank="18"
              direction="unchanged"
              downloads="163"/>

            <gradient 
              file="BlueDarkRed18" 
              dir="ncl"  
              rank="19"
              direction="up" 
              downloads="150"/>

            <gradient 
              file="grayscale02" 
              dir="ma/gray"  
              rank="20"
              direction="up" 
              downloads="146"/>

            <gradient 
              file="rainbow" 
              dir="oc"  
              rank="21"
              direction="up" 
              downloads="139"/>

            <gradient 
              file="jet" 
              dir="h5"  
              rank="21"
              direction="down"
              downloads="139"/>

            <gradient 
              file="temp_19lev" 
              dir="ncl"  
              rank="23"
              direction="down"
              downloads="137"/>

            <gradient 
              file="GMT_panoply" 
              dir="gmt"  
              rank="24"
              direction="up" 
              downloads="135"/>

            <gradient 
              file="GMT_polar" 
              dir="gmt"  
              rank="24"
              direction="down"
              downloads="135"/>

            <gradient 
              file="wiki-scotland" 
              dir="wkp/country"  
              rank="26"
              direction="up" 
              downloads="132"/>

            <gradient 
              file="usgs-gswa2" 
              dir="usgs"  
              rank="27"
              direction="down"
              downloads="131"/>

            <gradient 
              file="BlueYellowRed" 
              dir="ncl"  
              rank="28"
              direction="down"
              downloads="129"/>

            <gradient 
              file="GMT_topo" 
              dir="gmt"  
              rank="29"
              direction="up" 
              downloads="124"/>

            <gradient 
              file="bcyr" 
              dir="grass"  
              rank="30"
              direction="unchanged"
              downloads="123"/>

            <gradient 
              file="Spectral_11" 
              dir="cb/div"  
              rank="30"
              direction="up" 
              downloads="123"/>

            <gradient 
              file="subtle" 
              dir="jjg/misc"  
              rank="32"
              direction="unchanged"
              downloads="122"/>

            <gradient 
              file="NZ_blue" 
              dir="em"  
              rank="33"
              direction="unchanged"
              downloads="121"/>

            <gradient 
              file="wiki-france" 
              dir="wkp/country"  
              rank="34"
              direction="up" 
              downloads="120"/>

            <gradient 
              file="ibcao" 
              dir="ibcao"  
              rank="35"
              direction="down"
              downloads="119"/>

            <gradient 
              file="europe_3" 
              dir="esri/hypsometry/eu"  
              rank="35"
              direction="up" 
              downloads="119"/>

            <gradient 
              file="GMT_rainbow" 
              dir="gmt"  
              rank="37"
              direction="down"
              downloads="117"/>

            <gradient 
              file="temperature" 
              dir="jjg/misc"  
              rank="38"
              direction="down"
              downloads="113"/>

            <gradient 
              file="Blues_09" 
              dir="cb/seq"  
              rank="39"
              direction="down"
              downloads="108"/>

            <gradient 
              file="GMT_relief" 
              dir="gmt"  
              rank="40"
              direction="up" 
              downloads="107"/>

            <gradient 
              file="wiki-1.02" 
              dir="wkp/template"  
              rank="41"
              direction="up" 
              downloads="106"/>

            <gradient 
              file="ETOPO1-Reed" 
              dir="ngdc"  
              rank="42"
              direction="down"
              downloads="105"/>

            <gradient 
              file="GMT_haxby" 
              dir="gmt"  
              rank="43"
              direction="up" 
              downloads="104"/>

            <gradient 
              file="GMT_gray" 
              dir="gmt"  
              rank="43"
              direction="up" 
              downloads="104"/>

            <gradient 
              file="moon" 
              dir="pn"  
              rank="43"
              direction="down"
              downloads="104"/>

            <gradient 
              file="GMT_sealand" 
              dir="gmt"  
              rank="46"
              direction="unchanged"
              downloads="103"/>

            <gradient 
              file="YlOrRd_09" 
              dir="cb/seq"  
              rank="46"
              direction="up" 
              downloads="103"/>

            <gradient 
              file="thermal" 
              dir="cmocean"  
              rank="48"
              direction="down"
              downloads="102"/>

            <gradient 
              file="differences" 
              dir="grass"  
              rank="49"
              direction="down"
              downloads="95"/>

            <gradient 
              file="GMT_hot" 
              dir="gmt"  
              rank="49"
              direction="down"
              downloads="95"/>

            <gradient 
              file="GMT_ocean" 
              dir="gmt"  
              rank="51"
              direction="up" 
              downloads="94"/>

            <gradient 
              file="BlWhRe" 
              dir="ncl"  
              rank="52"
              direction="down"
              downloads="93"/>

            <gradient 
              file="Reds_09" 
              dir="cb/seq"  
              rank="52"
              direction="up" 
              downloads="93"/>

            <gradient 
              file="balance" 
              dir="cmocean"  
              rank="54"
              direction="up" 
              downloads="92"/>

            <gradient 
              file="cequal" 
              dir="imagej"  
              rank="54"
              direction="down"
              downloads="92"/>

            <gradient 
              file="sd-a" 
              dir="jm/sd"  
              rank="56"
              direction="up" 
              downloads="91"/>

            <gradient 
              file="wiki-schwarzwald-d050" 
              dir="wkp/schwarzwald"  
              rank="57"
              direction="up" 
              downloads="89"/>

            <gradient 
              file="deep" 
              dir="cmocean"  
              rank="57"
              direction="down"
              downloads="89"/>

            <gradient 
              file="afrikakarte" 
              dir="wkp/lilleskut"  
              rank="59"
              direction="down"
              downloads="88"/>

            <gradient 
              file="haline" 
              dir="cmocean"  
              rank="59"
              direction="up" 
              downloads="88"/>

            <gradient 
              file="nrwc" 
              dir="wkp/tubs"  
              rank="59"
              direction="down"
              downloads="88"/>

            <gradient 
              file="earth" 
              dir="gist"  
              rank="62"
              direction="down"
              downloads="87"/>

            <gradient 
              file="topo_15lev" 
              dir="ncl"  
              rank="62"
              direction="unchanged"
              downloads="87"/>

            <gradient 
              file="dkbluered" 
              dir="h5"  
              rank="64"
              direction="up" 
              downloads="86"/>

            <gradient 
              file="GMT_no_green" 
              dir="gmt"  
              rank="65"
              direction="down"
              downloads="84"/>

            <gradient 
              file="usgs-gswa1" 
              dir="usgs"  
              rank="66"
              direction="down"
              downloads="82"/>

            <gradient 
              file="seminf-haxby" 
              dir="jjg/misc"  
              rank="67"
              direction="down"
              downloads="81"/>

            <gradient 
              file="Caribbean" 
              dir="vh"  
              rank="67"
              direction="down"
              downloads="81"/>

            <gradient 
              file="sst" 
              dir="oc"  
              rank="69"
              direction="unchanged"
              downloads="77"/>

            <gradient 
              file="GMT_dem1" 
              dir="gmt"  
              rank="70"
              direction="up" 
              downloads="76"/>

            <gradient 
              file="precip2_17lev" 
              dir="ncl"  
              rank="70"
              direction="up" 
              downloads="76"/>

            <gradient 
              file="zambezi-proximity" 
              dir="arendal"  
              rank="72"
              direction="down"
              downloads="75"/>

            <gradient 
              file="bath_112" 
              dir="esri/hypsometry/bath"  
              rank="73"
              direction="down"
              downloads="73"/>

            <gradient 
              file="zambezi-focus" 
              dir="arendal"  
              rank="74"
              direction="unchanged"
              downloads="72"/>

            <gradient 
              file="purplefly" 
              dir="rc"  
              rank="75"
              direction="unchanged"
              downloads="63"/>

          </gradients>
        </selection>
        `
      const totpSvgXML = `
        <selection cadence="high">
          <name short="totp-svg">Top of the (svg) palettes</name>
          <synopsis>The 75 most popular svg gradients 
            on 31/08/2023</synopsis>
          <description>
            The 75 most popular svg files with the number downloaded 
            shown in parentheses. The arrows indicate the change in rank in the last
            month. This list is compiled from the files downloaded in the last year 
            (a total of 8,230 files) and is updated irregularly, most recently on 
            31/08/2023.
          </description>
          <gradients>

            <gradient 
              file="DEM_print" 
              dir="td"  
              rank="1"
              direction="unchanged"
              downloads="239"/>

            <gradient 
              file="temperature" 
              dir="arendal"  
              rank="2"
              direction="up" 
              downloads="188"/>

            <gradient 
              file="DEM_screen" 
              dir="td"  
              rank="3"
              direction="up" 
              downloads="184"/>

            <gradient 
              file="DEM_poster" 
              dir="td"  
              rank="4"
              direction="down"
              downloads="181"/>

            <gradient 
              file="elevation" 
              dir="grass"  
              rank="5"
              direction="unchanged"
              downloads="128"/>

            <gradient 
              file="usgs" 
              dir="usgs"  
              rank="6"
              direction="unchanged"
              downloads="100"/>

            <gradient 
              file="colombia" 
              dir="wkp/shadowxfox"  
              rank="7"
              direction="unchanged"
              downloads="99"/>

            <gradient 
              file="wiki-schwarzwald-cont" 
              dir="wkp/schwarzwald"  
              rank="8"
              direction="unchanged"
              downloads="84"/>

            <gradient 
              file="usgs-gswa2" 
              dir="usgs"  
              rank="9"
              direction="unchanged"
              downloads="66"/>

            <gradient 
              file="temperature" 
              dir="jjg/misc"  
              rank="10"
              direction="up" 
              downloads="59"/>

            <gradient 
              file="wiki-2.0" 
              dir="wkp/template"  
              rank="11"
              direction="unchanged"
              downloads="58"/>

            <gradient 
              file="europe_3" 
              dir="esri/hypsometry/eu"  
              rank="12"
              direction="down"
              downloads="56"/>

            <gradient 
              file="spain" 
              dir="esri/hypsometry/eu"  
              rank="12"
              direction="down"
              downloads="56"/>

            <gradient 
              file="europe_2" 
              dir="esri/hypsometry/eu"  
              rank="14"
              direction="up" 
              downloads="51"/>

            <gradient 
              file="usgs-feet" 
              dir="usgs"  
              rank="14"
              direction="unchanged"
              downloads="51"/>

            <gradient 
              file="sd-a" 
              dir="jm/sd"  
              rank="16"
              direction="up" 
              downloads="46"/>

            <gradient 
              file="wiki-schwarzwald-d050" 
              dir="wkp/schwarzwald"  
              rank="17"
              direction="unchanged"
              downloads="44"/>

            <gradient 
              file="mexico" 
              dir="esri/hypsometry/ca"  
              rank="18"
              direction="down"
              downloads="43"/>

            <gradient 
              file="nrwc" 
              dir="wkp/tubs"  
              rank="18"
              direction="up" 
              downloads="43"/>

            <gradient 
              file="ETOPO1" 
              dir="ngdc"  
              rank="20"
              direction="down"
              downloads="41"/>

            <gradient 
              file="NZ_blue" 
              dir="em"  
              rank="21"
              direction="up" 
              downloads="38"/>

            <gradient 
              file="europe_4" 
              dir="esri/hypsometry/eu"  
              rank="21"
              direction="up" 
              downloads="38"/>

            <gradient 
              file="earth" 
              dir="gist"  
              rank="23"
              direction="up" 
              downloads="37"/>

            <gradient 
              file="GMT_ocean" 
              dir="gmt"  
              rank="23"
              direction="up" 
              downloads="37"/>

            <gradient 
              file="Spectral_11" 
              dir="cb/div"  
              rank="25"
              direction="unchanged"
              downloads="36"/>

            <gradient 
              file="arctic" 
              dir="arendal"  
              rank="25"
              direction="down"
              downloads="36"/>

            <gradient 
              file="natural" 
              dir="fme/metres"  
              rank="25"
              direction="down"
              downloads="36"/>

            <gradient 
              file="bath_112" 
              dir="esri/hypsometry/bath"  
              rank="28"
              direction="up" 
              downloads="35"/>

            <gradient 
              file="topo_15lev" 
              dir="ncl"  
              rank="29"
              direction="up" 
              downloads="34"/>

            <gradient 
              file="temp-c" 
              dir="ukmo/wow"  
              rank="29"
              direction="up" 
              downloads="34"/>

            <gradient 
              file="sst" 
              dir="oc"  
              rank="29"
              direction="down"
              downloads="34"/>

            <gradient 
              file="cequal" 
              dir="imagej"  
              rank="32"
              direction="up" 
              downloads="33"/>

            <gradient 
              file="humidity" 
              dir="ukmo/wow"  
              rank="33"
              direction="up" 
              downloads="32"/>

            <gradient 
              file="rainbow" 
              dir="oc"  
              rank="33"
              direction="up" 
              downloads="32"/>

            <gradient 
              file="nordisk-familjebok" 
              dir="wkp/encyclopedia"  
              rank="35"
              direction="up" 
              downloads="31"/>

            <gradient 
              file="purplefly" 
              dir="rc"  
              rank="36"
              direction="down"
              downloads="30"/>

            <gradient 
              file="GMT_dem1" 
              dir="gmt"  
              rank="36"
              direction="down"
              downloads="30"/>

            <gradient 
              file="europe_9" 
              dir="esri/hypsometry/eu"  
              rank="36"
              direction="up" 
              downloads="30"/>

            <gradient 
              file="zambezi-proximity" 
              dir="arendal"  
              rank="36"
              direction="up" 
              downloads="30"/>

            <gradient 
              file="europe_8" 
              dir="esri/hypsometry/eu"  
              rank="36"
              direction="up" 
              downloads="30"/>

            <gradient 
              file="aurora" 
              dir="nord"  
              rank="36"
              direction="down"
              downloads="30"/>

            <gradient 
              file="illumination" 
              dir="esri/hillshade"  
              rank="42"
              direction="up" 
              downloads="29"/>

            <gradient 
              file="mby" 
              dir="mby"  
              rank="42"
              direction="down"
              downloads="29"/>

            <gradient 
              file="wiki-knutux" 
              dir="wkp/knutux"  
              rank="42"
              direction="up" 
              downloads="29"/>

            <gradient 
              file="GMT_seis" 
              dir="gmt"  
              rank="45"
              direction="down"
              downloads="28"/>

            <gradient 
              file="YlOrRd_05" 
              dir="cb/seq"  
              rank="45"
              direction="up" 
              downloads="28"/>

            <gradient 
              file="temp_19lev" 
              dir="ncl"  
              rank="45"
              direction="up" 
              downloads="28"/>

            <gradient 
              file="zambezi-focus" 
              dir="arendal"  
              rank="45"
              direction="down"
              downloads="28"/>

            <gradient 
              file="usgs-gswa1" 
              dir="usgs"  
              rank="49"
              direction="up" 
              downloads="27"/>

            <gradient 
              file="thermal" 
              dir="cmocean"  
              rank="50"
              direction="down"
              downloads="26"/>

            <gradient 
              file="bhw1_sunconure" 
              dir="bhw/bhw1"  
              rank="51"
              direction="up" 
              downloads="25"/>

            <gradient 
              file="GMT_dem4" 
              dir="gmt"  
              rank="51"
              direction="down"
              downloads="25"/>

            <gradient 
              file="bcyr" 
              dir="grass"  
              rank="51"
              direction="down"
              downloads="25"/>

            <gradient 
              file="wiki-schwarzwald-d100" 
              dir="wkp/schwarzwald"  
              rank="54"
              direction="up" 
              downloads="24"/>

            <gradient 
              file="ibcao" 
              dir="ibcao"  
              rank="54"
              direction="down"
              downloads="24"/>

            <gradient 
              file="wiki-schwarzwald-d010" 
              dir="wkp/schwarzwald"  
              rank="54"
              direction="down"
              downloads="24"/>

            <gradient 
              file="rainfall" 
              dir="jjg/misc"  
              rank="57"
              direction="up" 
              downloads="23"/>

            <gradient 
              file="europe_7" 
              dir="esri/hypsometry/eu"  
              rank="57"
              direction="up" 
              downloads="23"/>

            <gradient 
              file="ndvi" 
              dir="oc"  
              rank="57"
              direction="down"
              downloads="23"/>

            <gradient 
              file="europe_6" 
              dir="esri/hypsometry/eu"  
              rank="57"
              direction="unchanged"
              downloads="23"/>

            <gradient 
              file="bath_115" 
              dir="esri/hypsometry/bath"  
              rank="61"
              direction="down"
              downloads="22"/>

            <gradient 
              file="YlOrRd_08" 
              dir="cb/seq"  
              rank="61"
              direction="down"
              downloads="22"/>

            <gradient 
              file="precip_11lev" 
              dir="ncl"  
              rank="61"
              direction="down"
              downloads="22"/>

            <gradient 
              file="ETOPO1-Reed" 
              dir="ngdc"  
              rank="61"
              direction="up" 
              downloads="22"/>

            <gradient 
              file="deep" 
              dir="cmocean"  
              rank="61"
              direction="down"
              downloads="22"/>

            <gradient 
              file="wiki-france" 
              dir="wkp/country"  
              rank="66"
              direction="up" 
              downloads="21"/>

            <gradient 
              file="YlOrRd_09" 
              dir="cb/seq"  
              rank="66"
              direction="up" 
              downloads="21"/>

            <gradient 
              file="palm_springs_4" 
              dir="esri/hypsometry/na"  
              rank="68"
              direction="up" 
              downloads="20"/>

            <gradient 
              file="GMT_topo" 
              dir="gmt"  
              rank="68"
              direction="down"
              downloads="20"/>

            <gradient 
              file="utah_1" 
              dir="esri/hypsometry/na"  
              rank="68"
              direction="up" 
              downloads="20"/>

            <gradient 
              file="GMT_globe" 
              dir="gmt"  
              rank="68"
              direction="up" 
              downloads="20"/>

            <gradient 
              file="precip2_17lev" 
              dir="ncl"  
              rank="68"
              direction="down"
              downloads="20"/>

            <gradient 
              file="OS_WAT_Mars" 
              dir="wesson"  
              rank="68"
              direction="up" 
              downloads="20"/>

            <gradient 
              file="chile" 
              dir="esri/hypsometry/sa"  
              rank="68"
              direction="down"
              downloads="20"/>

            <gradient 
              file="haline" 
              dir="cmocean"  
              rank="75"
              direction="down"
              downloads="19"/>

          </gradients>
        </selection>
              `
      const totpQgsXML = `
        <selection cadence="high">
          <name short="totp-qgs">Top of the (qgs) palettes</name>
          <synopsis>The 75 most popular qgs gradients 
            on 31/08/2023</synopsis>
          <description>
            The 75 most popular qgs files with the number downloaded 
            shown in parentheses. The arrows indicate the change in rank in the last
            month. This list is compiled from the files downloaded in the last year 
            (a total of 2,227 files) and is updated irregularly, most recently on 
            31/08/2023.
          </description>
          <gradients>

            <gradient 
              file="DEM_print" 
              dir="td"  
              rank="1"
              direction="unchanged"
              downloads="87"/>

            <gradient 
              file="temperature" 
              dir="arendal"  
              rank="2"
              direction="up" 
              downloads="74"/>

            <gradient 
              file="DEM_screen" 
              dir="td"  
              rank="3"
              direction="unchanged"
              downloads="45"/>

            <gradient 
              file="DEM_poster" 
              dir="td"  
              rank="4"
              direction="up" 
              downloads="37"/>

            <gradient 
              file="colombia" 
              dir="wkp/shadowxfox"  
              rank="5"
              direction="down"
              downloads="35"/>

            <gradient 
              file="usgs" 
              dir="usgs"  
              rank="6"
              direction="unchanged"
              downloads="34"/>

            <gradient 
              file="wiki-2.0" 
              dir="wkp/template"  
              rank="7"
              direction="unchanged"
              downloads="26"/>

            <gradient 
              file="sd-a" 
              dir="jm/sd"  
              rank="8"
              direction="unchanged"
              downloads="25"/>

            <gradient 
              file="elevation" 
              dir="grass"  
              rank="9"
              direction="unchanged"
              downloads="23"/>

            <gradient 
              file="purplefly" 
              dir="rc"  
              rank="10"
              direction="unchanged"
              downloads="21"/>

            <gradient 
              file="arctic" 
              dir="arendal"  
              rank="10"
              direction="up" 
              downloads="21"/>

            <gradient 
              file="usgs-gswa2" 
              dir="usgs"  
              rank="12"
              direction="down"
              downloads="20"/>

            <gradient 
              file="wiki-schwarzwald-cont" 
              dir="wkp/schwarzwald"  
              rank="12"
              direction="up" 
              downloads="20"/>

            <gradient 
              file="NZ_blue" 
              dir="em"  
              rank="14"
              direction="up" 
              downloads="19"/>

            <gradient 
              file="ETOPO1" 
              dir="ngdc"  
              rank="15"
              direction="down"
              downloads="18"/>

            <gradient 
              file="usgs-feet" 
              dir="usgs"  
              rank="15"
              direction="down"
              downloads="18"/>

            <gradient 
              file="europe_3" 
              dir="esri/hypsometry/eu"  
              rank="15"
              direction="up" 
              downloads="18"/>

            <gradient 
              file="wiki-schwarzwald-d100" 
              dir="wkp/schwarzwald"  
              rank="18"
              direction="unchanged"
              downloads="16"/>

            <gradient 
              file="GMT_seis" 
              dir="gmt"  
              rank="19"
              direction="unchanged"
              downloads="13"/>

            <gradient 
              file="europe_2" 
              dir="esri/hypsometry/eu"  
              rank="19"
              direction="unchanged"
              downloads="13"/>

            <gradient 
              file="cequal" 
              dir="imagej"  
              rank="19"
              direction="up" 
              downloads="13"/>

            <gradient 
              file="spain" 
              dir="esri/hypsometry/eu"  
              rank="22"
              direction="unchanged"
              downloads="12"/>

            <gradient 
              file="zambezi-proximity" 
              dir="arendal"  
              rank="23"
              direction="up" 
              downloads="11"/>

            <gradient 
              file="GMT_globe" 
              dir="gmt"  
              rank="23"
              direction="up" 
              downloads="11"/>

            <gradient 
              file="europe_4" 
              dir="esri/hypsometry/eu"  
              rank="23"
              direction="up" 
              downloads="11"/>

            <gradient 
              file="ETOPO1-Reed" 
              dir="ngdc"  
              rank="23"
              direction="up" 
              downloads="11"/>

            <gradient 
              file="deep" 
              dir="cmocean"  
              rank="23"
              direction="down"
              downloads="11"/>

            <gradient 
              file="mby" 
              dir="mby"  
              rank="23"
              direction="up" 
              downloads="11"/>

            <gradient 
              file="ibcao" 
              dir="ibcao"  
              rank="23"
              direction="up" 
              downloads="11"/>

            <gradient 
              file="sst" 
              dir="oc"  
              rank="30"
              direction="down"
              downloads="10"/>

            <gradient 
              file="europe_6" 
              dir="esri/hypsometry/eu"  
              rank="30"
              direction="down"
              downloads="10"/>

            <gradient 
              file="topo" 
              dir="cmocean"  
              rank="32"
              direction="up" 
              downloads="9"/>

            <gradient 
              file="temp-c" 
              dir="ukmo/wow"  
              rank="32"
              direction="up" 
              downloads="9"/>

            <gradient 
              file="aurora" 
              dir="nord"  
              rank="32"
              direction="down"
              downloads="9"/>

            <gradient 
              file="earth" 
              dir="gist"  
              rank="32"
              direction="down"
              downloads="9"/>

            <gradient 
              file="wiki-zurich" 
              dir="wkp/country"  
              rank="32"
              direction="up" 
              downloads="9"/>

            <gradient 
              file="Sunset_Real" 
              dir="nd/atmospheric"  
              rank="32"
              direction="up" 
              downloads="9"/>

            <gradient 
              file="bhw1_01" 
              dir="bhw/bhw1"  
              rank="32"
              direction="up" 
              downloads="9"/>

            <gradient 
              file="wiki-schwarzwald-d050" 
              dir="wkp/schwarzwald"  
              rank="32"
              direction="up" 
              downloads="9"/>

            <gradient 
              file="zambezi-focus" 
              dir="arendal"  
              rank="32"
              direction="down"
              downloads="9"/>

            <gradient 
              file="delta" 
              dir="cmocean"  
              rank="41"
              direction="unchanged"
              downloads="8"/>

            <gradient 
              file="ib_jul01" 
              dir="ing/xmas"  
              rank="41"
              direction="unchanged"
              downloads="8"/>

            <gradient 
              file="GMT_topo" 
              dir="gmt"  
              rank="41"
              direction="unchanged"
              downloads="8"/>

            <gradient 
              file="thermal" 
              dir="cmocean"  
              rank="41"
              direction="unchanged"
              downloads="8"/>

            <gradient 
              file="seismic" 
              dir="gery"  
              rank="41"
              direction="down"
              downloads="8"/>

            <gradient 
              file="nordisk-familjebok" 
              dir="wkp/encyclopedia"  
              rank="41"
              direction="up" 
              downloads="8"/>

            <gradient 
              file="moon" 
              dir="pn"  
              rank="41"
              direction="up" 
              downloads="8"/>

            <gradient 
              file="usgs-gswa1" 
              dir="usgs"  
              rank="41"
              direction="down"
              downloads="8"/>

            <gradient 
              file="europe_9" 
              dir="esri/hypsometry/eu"  
              rank="41"
              direction="up" 
              downloads="8"/>

            <gradient 
              file="GMT_ocean" 
              dir="gmt"  
              rank="50"
              direction="up" 
              downloads="7"/>

            <gradient 
              file="rainbow" 
              dir="oc"  
              rank="50"
              direction="down"
              downloads="7"/>

            <gradient 
              file="bhw1_28" 
              dir="bhw/bhw1"  
              rank="50"
              direction="up" 
              downloads="7"/>

            <gradient 
              file="temperature" 
              dir="jjg/misc"  
              rank="50"
              direction="up" 
              downloads="7"/>

            <gradient 
              file="chile" 
              dir="esri/hypsometry/sa"  
              rank="50"
              direction="down"
              downloads="7"/>

            <gradient 
              file="phase" 
              dir="cmocean"  
              rank="50"
              direction="up" 
              downloads="7"/>

            <gradient 
              file="wiki-schwarzwald-d020" 
              dir="wkp/schwarzwald"  
              rank="50"
              direction="down"
              downloads="7"/>

            <gradient 
              file="natural" 
              dir="fme/metres"  
              rank="50"
              direction="down"
              downloads="7"/>

            <gradient 
              file="wiki-scotland" 
              dir="wkp/country"  
              rank="50"
              direction="up" 
              downloads="7"/>

            <gradient 
              file="wiki-1.02" 
              dir="wkp/template"  
              rank="50"
              direction="up" 
              downloads="7"/>

            <gradient 
              file="polar-night" 
              dir="nord"  
              rank="60"
              direction="down"
              downloads="6"/>

            <gradient 
              file="frost" 
              dir="nord"  
              rank="60"
              direction="up" 
              downloads="6"/>

            <gradient 
              file="BlWhRe" 
              dir="ncl"  
              rank="60"
              direction="down"
              downloads="6"/>

            <gradient 
              file="nrwc" 
              dir="wkp/tubs"  
              rank="60"
              direction="up" 
              downloads="6"/>

            <gradient 
              file="wiki-1.03" 
              dir="wkp/template"  
              rank="60"
              direction="up" 
              downloads="6"/>

            <gradient 
              file="europe_8" 
              dir="esri/hypsometry/eu"  
              rank="60"
              direction="down"
              downloads="6"/>

            <gradient 
              file="turbid" 
              dir="cmocean"  
              rank="60"
              direction="down"
              downloads="6"/>

            <gradient 
              file="rain" 
              dir="cmocean"  
              rank="60"
              direction="down"
              downloads="6"/>

            <gradient 
              file="celsius" 
              dir="grass"  
              rank="60"
              direction="down"
              downloads="6"/>

            <gradient 
              file="balance" 
              dir="cmocean"  
              rank="60"
              direction="down"
              downloads="6"/>

            <gradient 
              file="curl" 
              dir="cmocean"  
              rank="60"
              direction="down"
              downloads="6"/>

            <gradient 
              file="bath_115" 
              dir="esri/hypsometry/bath"  
              rank="71"
              direction="down"
              downloads="5"/>

            <gradient 
              file="BlueWhiteOrangeRed" 
              dir="ncl"  
              rank="71"
              direction="unchanged"
              downloads="5"/>

            <gradient 
              file="bcyr" 
              dir="grass"  
              rank="71"
              direction="down"
              downloads="5"/>

            <gradient 
              file="haline" 
              dir="cmocean"  
              rank="71"
              direction="up" 
              downloads="5"/>

            <gradient 
              file="neutral" 
              dir="fme/metres"  
              rank="71"
              direction="unchanged"
              downloads="5"/>

          </gradients>
        </selection>
        `

      const topobathGradients = parseViewXML(topobathXML);
      const topoGradients = parseViewXML(topoXML);
      const tempGradients = parseViewXML(tempXML);
      const totpCptGradients = parseViewXML(totpCptXML);
      const totpSvgGradients = parseViewXML(totpSvgXML);
      const totpQgsGradients = parseViewXML(totpQgsXML);
      
      console.log({topobathGradients, topoGradients, tempGradients, totpCptGradients, totpSvgGradients, totpQgsGradients});

      viewsData.topobath = { name: "Topography/bathymetry", short: "topobath", gradients: topobathGradients };
      viewsData.topo = { name: "Topography", short: "topo", gradients: topoGradients };
      viewsData.temp = { name: "Temperature", short: "temp", gradients: tempGradients };
      viewsData.totpCpt = { name: "Top 75 CPT", short: "totpCpt", gradients: totpCptGradients };
      viewsData.totpSvg = { name: "Top 75 SVG", short: "totpSvg", gradients: totpSvgGradients };
      viewsData.totpQgs = { name: "Top 75 QGS", short: "totpQgs", gradients: totpQgsGradients };
      
      viewFilter.innerHTML += '<option value="topobath">Topography/bathymetry (' + topobathGradients.length + ')</option>';
      viewFilter.innerHTML += '<option value="topo">Topography (' + topoGradients.length + ')</option>';
      viewFilter.innerHTML += '<option value="temp">Temperature (' + tempGradients.length + ')</option>';
      viewFilter.innerHTML += '<option value="totpCpt">Top 75 CPT (' + totpCptGradients.length + ')</option>';
      viewFilter.innerHTML += '<option value="totpSvg">Top 75 SVG (' + totpSvgGradients.length + ')</option>';
      viewFilter.innerHTML += '<option value="totpQgs">Top 75 QGS (' + totpQgsGradients.length + ')</option>';
    }

    function matchesView(cpt, viewShort) {
      if (viewShort === 'all' || !viewsData[viewShort]) {
        return true;
      }
      
      const view = viewsData[viewShort];
      return view.gradients.some(function(g) {
        const expectedPath = 'cpt-city/' + g.dir + '/' + g.file + '.cpt';
        return cpt.path === expectedPath || 
               (cpt.name === g.file && cpt.directory.endsWith(g.dir));
      });
    }

    // ============================================================================
    // UI HELPER FUNCTIONS
    // ============================================================================
    function getImageUrl(cptPath) {
      const parts = cptPath.split('/');
      const filename = parts[parts.length - 1].replace('.cpt', '.png');
      const dir = parts.slice(0, -1).join('/');
      return 'http://seaviewsensing.com/pub/' + dir + '/tn/' + filename;
    }

    function getAuthorUrl(directory) {
      const parts = directory.split('/').filter(function(p) { return p; });
      const baseDir = parts.slice(0, 2).join('/');
      return 'http://seaviewsensing.com/pub/' + baseDir;
    }

    function getCopyingUrl(copyingPath) {
      if (!copyingPath) return null;
      return 'http://seaviewsensing.com/pub/' + copyingPath;
    }
    
    function populateDirectoryFilter() {
      const dirFilter = document.getElementById('dirFilter');
      const dirs = Object.keys(parsedData.directories).sort();
      
      dirFilter.innerHTML = '<option value="all">All Directories</option>';
      dirs.forEach(function(dir) {
        const option = document.createElement('option');
        option.value = dir;
        option.textContent = dir + ' (' + parsedData.directories[dir].length + ')';
        dirFilter.appendChild(option);
      });
    }

    // ============================================================================
    // TABLE MANAGEMENT
    // ============================================================================
    function initializeTable() {
      const headerRow = document.getElementById('tableHeader');
      const filterRow = document.getElementById('tableFilters');
      
      headerRow.innerHTML = '';
      filterRow.innerHTML = '';
      
      columns.forEach(function(col) {
        const th = document.createElement('th');
        th.textContent = col.label;
        if (col.sortable) {
          th.style.cursor = 'pointer';
          th.onclick = function() { sortTable(col.id); };
        }
        headerRow.appendChild(th);

        const td = document.createElement('td');
        if (col.filterable) {
          const input = document.createElement('input');
          input.type = 'text';
          input.placeholder = 'Filter ' + col.label + '...';
          input.oninput = function(e) {
            columnFilters[col.id] = e.target.value.toLowerCase();
            currentPage = 1;
            applyFilters();
          };
          td.appendChild(input);
        }
        filterRow.appendChild(td);
      });
    }

    function sortTable(columnId) {
      if (sortColumn === columnId) {
        sortDirection = sortDirection === 'asc' ? 'desc' : 'asc';
      } else {
        sortColumn = columnId;
        sortDirection = 'asc';
      }
      applyFilters();
    }
    
    // ============================================================================
    // FILTERING AND DISPLAY
    // ============================================================================
    function applyFilters() {
      const viewFilter = document.getElementById('viewFilter').value;
      const licenseFilter = document.getElementById('licenseFilter').value;
      const nameSearch = document.getElementById('nameSearch').value.toLowerCase();
      const dirFilter = document.getElementById('dirFilter').value;
      
      currentView = viewFilter;
      
      filteredData = parsedData.cpts.filter(function(cpt) {
        if (!matchesView(cpt, viewFilter)) {
          return false;
        }

        if (licenseFilter === 'open') {
          if (!cpt.isOpenLicense) return false;
        } else if (licenseFilter === 'distribute-yes') {
          if (cpt.distribute !== 'yes') return false;
        } else if (licenseFilter === 'open-distribute') {
          if (!cpt.isOpenLicense || cpt.distribute !== 'yes') return false;
        }
        
        if (nameSearch && !cpt.name.toLowerCase().includes(nameSearch)) {
          return false;
        }
        
        if (dirFilter !== 'all' && cpt.directory !== dirFilter) {
          return false;
        }

        for (const col in columnFilters) {
          const value = columnFilters[col];
          if (value && !String(cpt[col]).toLowerCase().includes(value)) {
            return false;
          }
        }
        
        return true;
      });

      if (sortColumn) {
        filteredData.sort(function(a, b) {
          let aVal = a[sortColumn];
          let bVal = b[sortColumn];
          
          if (typeof aVal === 'string') {
            aVal = aVal.toLowerCase();
            bVal = bVal.toLowerCase();
          }
          
          if (aVal < bVal) return sortDirection === 'asc' ? -1 : 1;
          if (aVal > bVal) return sortDirection === 'asc' ? 1 : -1;
          return 0;
        });
      }

      updateStats();
      displayTable();
    }

    function updateStats() {
      document.getElementById('totalCpts').textContent = parsedData.stats.totalCpts;
      document.getElementById('totalDirs').textContent = parsedData.stats.totalDirectories;
      document.getElementById('filteredCpts').textContent = filteredData.length;
      document.getElementById('openLicenseCpts').textContent = parsedData.stats.openLicenseCpts;
    }

    function displayTable() {
      const tbody = document.getElementById('tableBody');
      tbody.innerHTML = '';
      
      document.getElementById('results').style.display = 'block';

      itemsPerPage = parseInt(document.getElementById('itemsPerPage').value);
      const start = (currentPage - 1) * itemsPerPage;
      const end = start + itemsPerPage;
      const pageData = filteredData.slice(start, end);

      pageData.forEach(function(cpt) {
        const tr = document.createElement('tr');
        
        const imgUrl = getImageUrl(cpt.path);
        const authorUrl = getAuthorUrl(cpt.directory);
        const copyingUrl = getCopyingUrl(cpt.copyingFile);
        const licenseShort = formatLicense(cpt.license);
        const licenseClass = getLicenseClass(cpt.license);

        tr.innerHTML = '<td><img src="' + imgUrl + '" class="cpt-image" alt="' + cpt.name + '" title="Click to view larger" onclick="window.open(\'' + imgUrl + '\', \'_blank\')"></td>' +
          '<td><strong>' + cpt.name + '</strong></td>' +
          '<td><small>' + cpt.directory + '</small></td>' +
          '<td><span class="license-badge ' + licenseClass + '" title="' + cpt.license + '">' + licenseShort + '</span></td>' +
          '<td><span class="' + (cpt.distribute === 'yes' ? 'distribute-yes' : 'distribute-no') + '">' + cpt.distribute + '</span></td>' +
          '<td><a href="' + authorUrl + '" target="_blank">' + (cpt.author || 'unknown') + '</a></td>' +
          '<td>' + (copyingUrl ? '<a href="' + copyingUrl + '" target="_blank">üìÑ View</a>' : '-') + '</td>';
        
        tbody.appendChild(tr);
      });

      updatePagination();
    }

    function updatePagination() {
      const totalPages = Math.ceil(filteredData.length / itemsPerPage);
      const start = (currentPage - 1) * itemsPerPage + 1;
      const end = Math.min(start + itemsPerPage - 1, filteredData.length);
      
      document.getElementById('paginationInfo').textContent = 
        'Showing ' + start + '-' + end + ' of ' + filteredData.length + ' items';
      
      document.getElementById('pageInput').value = currentPage;
      document.getElementById('pageInput').max = totalPages;
    }

    function changePage(delta) {
      const totalPages = Math.ceil(filteredData.length / itemsPerPage);
      const newPage = currentPage + delta;
      
      if (newPage >= 1 && newPage <= totalPages) {
        currentPage = newPage;
        displayTable();
      }
    }

    // ============================================================================
    // EXPORT FUNCTIONS
    // ============================================================================
    function downloadJSON() {
      try {
        const dataStr = JSON.stringify(parsedData, null, 2);
        const blob = new Blob([dataStr], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'cpt-city-full.json';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      } catch (error) {
        console.error('Export error:', error);
        alert('Failed to export JSON: ' + error.message);
      }
    }
    
    function downloadFiltered() {
      try {
        const dataStr = JSON.stringify(filteredData, null, 2);
        const blob = new Blob([dataStr], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = 'cpt-city-filtered.json';
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      } catch (error) {
        console.error('Export error:', error);
        alert('Failed to export filtered JSON: ' + error.message);
      }
    }
    
    async function copyToClipboard() {
      try {
        const dataStr = JSON.stringify(filteredData, null, 2);
        await navigator.clipboard.writeText(dataStr);
        alert('Copied to clipboard!');
      } catch (err) {
        console.error('Failed to copy:', err);
        alert('Failed to copy to clipboard');
      }
    }
    
    // ============================================================================
    // EVENT LISTENERS
    // ============================================================================
    document.getElementById('pageInput').addEventListener('change', function(e) {
      const totalPages = Math.ceil(filteredData.length / itemsPerPage);
      let page = parseInt(e.target.value);
      
      if (page >= 1 && page <= totalPages) {
        currentPage = page;
        displayTable();
      } else {
        e.target.value = currentPage;
      }
    });
    
    document.getElementById('viewFilter').addEventListener('change', function() {
      currentPage = 1;
      applyFilters();
    });

    document.getElementById('licenseFilter').addEventListener('change', function() {
      currentPage = 1;
      applyFilters();
    });
    
    document.getElementById('nameSearch').addEventListener('input', function() {
      currentPage = 1;
      applyFilters();
    });
    
    document.getElementById('dirFilter').addEventListener('change', function() {
      currentPage = 1;
      applyFilters();
    });

    document.getElementById('itemsPerPage').addEventListener('change', function() {
      currentPage = 1;
      applyFilters();
    });
  </script>
</body>
</html>